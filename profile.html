<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>üë§ Profile</title>
	<script type="text/javascript" src="tabulator.min.js"></script>
	<script type="text/javascript" src="peity-vanilla.min.js"></script>
	<script type="text/javascript" src="flatpickr.min.js"></script>
	<link href="tabulator.min.css" rel="stylesheet">
	<link href="flatpickr.min.css" rel="stylesheet">
	<link href="style.css" rel="stylesheet">
	<script src="plotly-3.0.0.min.js" charset="utf-8"></script>
	<script src="math.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<link rel="icon" type="image/x-icon" href="logos/icon.png">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FX06BZ5MRL"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-FX06BZ5MRL');
</script>

<style>
	body {
		margin: 0; padding: 0;
		font-size: 18px;
		height: 100vh;
	}
	#discord_username {
		margin-bottom: 0.5rem;
	}
	@media (max-width: 600px) {
	}
</style>
<body>
	<div id="header">
		<div id="title">
			<h1>+EV Dingers</h1>
		</div>
		<div id="sub-header">
			<div class="dropdown">
				<select id="page-select"></select>
				<svg viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="dropdown__arrow css-jbgpyq ehya2ln0" fill="#A4A4AA" stroke="#A4A4AA" stroke-width="0"><title>Right Arrow</title><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg>
			</div>
		</div>
		<div id="auth-buttons">
			<span id="username"></span>
			<span id="status"></span>
			<input id="email" type="text" placeholder="Email" >
			<button id="login" onclick="login()">Login</button>
			<button id="account" class="loggedIn" onclick="changePage('profile')">Profile</button>
			<button id="upgrade" class="loggedIn" onclick="changePage('pricing')">Upgrade üëë</button>
			<button id="logout" class="loggedIn" onclick="logout()">Logout</button>
		</div>
	</div>
	<div class="profile-container">
		<div class="profile-header">
			<div class="profile-badge">üëë</div>
			<div id="profile-info">
				<h2 class="username">zhecht7@gmail.com</h2>
				<button class="upgrade-btn" onclick="changePage('pricing')">Upgrade / Manage</button>
			</div>
		</div>
		<div class="profile-subscription">
			<h3>Subscription Details</h3>
			<div class="sub-grid">
				<div>
					<span class="label">Plan:</span>
					<span class="value">VIP Tier</span>
				</div>
				<div>
					<span class="label">Next Renewal:</span>
					<span id="next_renewal" class="value"></span>
				</div>
				<div>
					<span class="label">Discord:</span>
					<span class="value">
						<span id="discord_username">N/A</span>
					</span>
				</div>
			</div>

			<!-- Quick Links -->
			<div class="profile-links">
				<h3>Account Actions</h3>
				<button class="link-btn" onclick="connectDiscord()">üîó Connect Discord</button>
				<button class="link-btn" onclick="cancelSubscription()">‚ùå Cancel Subscription</button>
			</div>
		</div>
	</div>
	<script src="auth.js"></script>
	<script type="text/javascript" src="shared.js"></script>
	<script type="text/javascript">
		PAGE = "profile";

		async function connectDiscord() {
			/*
			const response = await fetch('http://localhost:5000/api/discord/login', {
				method: 'POST',
				headers: { 
					Authorization: `Bearer ${ACCESS_TOKEN}`
				},
			});
			const data = await response.json();
			*/
			const { data: { session }, error } = await SB.auth.getSession();
			window.location.href = "http://localhost:5000/api/discord/login?user_id="+session.user.id;
		}

		async function cancelSubscription() {
			const response = await fetch('/api/create-portal-session', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ customerId: "CURRENT_USER_CUSTOMER_ID" })
		});
		const data = await response.json();
		window.location.href = data.url; // Stripe handles the rest
			}
	</script>
</body>
</html>
